export MAPR_MAPREDUCE_MODE=yarn;
hive -s "Insert into table ogoud.item_analytics partition (cre_dt) select date_id, product_identifier_type, get_json_object(product_offer_json,'$.offerPublishStatus') Pub_sts, get_json_object(oscar_json,'$.result.offerAttributes.entry.logistics.isPutEligible') PUT, get_json_object(oscar_json,'$.result.offerAttributes.entry.logistics.isS2HEligible') S2H, get_json_object(oscar_json,'$.result.offerAttributes.entry.logistics.isS2SEligible') S2S, count(distinct product_id) as prod_cnt, FROM_UNIXTIME(UNIX_TIMESTAMP(),'yyyy-MM-dd') from catint.uber_flat_product_daily where date_id='20180312' and get_json_object(product_offer_json,'$.offerLifecycleStatus')='ACTIVE' and product_identifier_type<>'PRIMARY_PRODUCT_OFFER' group by date_id, product_identifier_type, get_json_object(product_offer_json,'$.offerPublishStatus'), get_json_object(oscar_json,'$.result.offerAttributes.entry.logistics.isPutEligible'), get_json_object(oscar_json,'$.result.offerAttributes.entry.logistics.isS2HEligible'), get_json_object(oscar_json,'$.result.offerAttributes.entry.logistics.isS2SEligible')




export MAPR_MAPREDUCE_MODE=yarn;
hive -e "set hive.cli.print.header=true; select product_identifier_type, pub_sts, count(distinct product_id) pcnt, sum(top) topcnt, sum(put_cnt) putcnt from (select product_id, product_identifier_type, pub_sts,  max(Top1M) top, max(PUT) put_cnt from (select u.product_id, u.product_identifier_type, get_json_object(u.product_offer_json,'$.offerPublishStatus') Pub_sts, case when get_json_object(u.product_offer_panama_json, '$.offer.productId.upc') = t.barcode then 1 else 0 end as Top1M, case when u.product_identifier_type='DOTCOM_OFFER' and get_json_object(u.oscar_json,'$.result.offerAttributes.entry.logistics.isPutEligible')='true' then 1 else 0 end as PUT from catint.uber_flat_product_daily u left join euc0001.top_mm_go_get t on get_json_object(u.product_offer_panama_json, '$.offer.productId.upc')=t.barcode where u.date_id='20180318' and u.product_identifier_type!='PRIMARY_PRODUCT_OFFER' and t.ds='2018-02-02' and t.is_top_l1_100k = 1 and get_json_object(u.product_offer_json,'$.offerPublishStatus')='Published') a group by product_id, product_identifier_type, pub_sts) b group by product_identifier_type, pub_sts" > itemanal040.xls;



export MAPR_MAPREDUCE_MODE=yarn;
hive -e "set hive.cli.print.header=true; select product_identifier_type, Pub_sts, count(distinct product_id) pcnt, count(offer_id) offr_cnt, sum(t) top, sum(putcnt) put_cnt from (select product_id, offer_id, product_identifier_type, Pub_sts, max(PUT) putcnt, max(Top1M) t from (select distinct u.product_id, u.offer_id, t.barcode, u.product_identifier_type, get_json_object(u.product_offer_json,'$.offerPublishStatus') Pub_sts, case when get_json_object(u.product_offer_panama_json, '$.offer.productId.upc') = t.barcode then 1 else 0 end as Top1M, case when u.product_identifier_type='DOTCOM_OFFER' and get_json_object(u.oscar_json,'$.result.offerAttributes.entry.logistics.isPutEligible')='true' then 1 else 0 end as PUT from catint.uber_flat_product_daily u left join euc0001.top_mm_go_get t on get_json_object(u.product_offer_panama_json, '$.offer.productId.upc')=t.barcode where u.date_id='20180318' and t.ds='2018-02-02' and t.is_top_l1_100k = 1 and u.product_identifier_type!='PRIMARY_PRODUCT_OFFER') a group by product_id, offer_id, product_identifier_type, Pub_sts) b group by product_identifier_type, Pub_sts " > itemanal0915.xls;


***********^^^^^^^^^^^^^^*************************@@@@@@@@@@@@

export MAPR_MAPREDUCE_MODE=yarn;
hive -e "set hive.cli.print.header=true; select date_id, product_identifier_type, Pub_sts, count(distinct product_id) pcnt, count(offer_id) offr_cnt, count(barcode) top, sum(putcnt) PUT_cnt, sum(s2hcnt) S2H_cnt, sum(s2scnt) S2S_cnt from (select a.date_id, a.product_id, a.offer_id, a.product_identifier_type, t.barcode, a.Pub_sts, max(a.PUT) putcnt, max(a.S2H) s2hcnt, max(a.S2S) s2scnt from (select u.date_id, distinct u.product_id, u.offer_id, u.product_identifier_type, get_json_object(u.product_offer_panama_json, '$.offer.productId.upc') UPC, get_json_object(u.product_offer_json,'$.offerPublishStatus') Pub_sts, case when u.product_identifier_type='DOTCOM_OFFER' and get_json_object(u.oscar_json,'$.result.offerAttributes.entry.logistics.isPutEligible')='true' then 1 else 0 end as PUT, case when u.product_identifier_type='DOTCOM_OFFER' and get_json_object(u.oscar_json,'$.result.offerAttributes.entry.logistics.isS2HEligible')='true' then 1 else 0 end as S2H, case when u.product_identifier_type='DOTCOM_OFFER' and get_json_object(u.oscar_json,'$.result.offerAttributes.entry.logistics.isS2SEligible')='true' then 1 else 0 end as S2S from catint.uber_flat_product_daily u  where u.date_id='20180321' and u.product_identifier_type!='PRIMARY_PRODUCT_OFFER' and get_json_object(product_offer_json,'$.offerLifecycleStatus')='ACTIVE') a left outer join (select barcode from euc0001.top_mm_go_get where ds='2018-02-02' and is_top_1m = 1) t on a.UPC=t.barcode group by a.date_id, a.product_id, a.offer_id, t.barcode, a.product_identifier_type, a.Pub_sts) b group by date_id, product_identifier_type, Pub_sts " > itemanal09120.xls;

***********^^^^^^^^^^^^^^*************************@@@@@@@@@@@@


export MAPR_MAPREDUCE_MODE=yarn;
hive -e "set hive.cli.print.header=true; select ds, barcode from euc0001.top_mm_go_get where ds='2018-02-02' and is_top_1m = 1 " > top1m.xls;



create table item_trends (uber_date string, prod_identifier_type string, status string, prod_cnt string, offr_cnt string, top1m string, PUT_cnt string, S2H_cnt string, S2S_cnt string, cre_dt date)STORED AS ORC;


insert into table ogoud.item_trends select date_id, product_identifier_type, Pub_sts, count(distinct product_id) pcnt, count(offer_id) offr_cnt, count(barcode) top, sum(putcnt) PUT_cnt, sum(s2hcnt) S2H_cnt, sum(s2scnt) S2S_cnt,  from (select a.date_id, a.product_id, a.offer_id, a.product_identifier_type, t.barcode, a.Pub_sts, max(a.PUT) putcnt, max(a.S2H) s2hcnt, max(a.S2S) s2scnt from (select u.date_id, distinct u.product_id, u.offer_id, u.product_identifier_type, get_json_object(u.product_offer_panama_json, '$.offer.productId.upc') UPC, get_json_object(u.product_offer_json,'$.offerPublishStatus') Pub_sts, case when u.product_identifier_type='DOTCOM_OFFER' and get_json_object(u.oscar_json,'$.result.offerAttributes.entry.logistics.isPutEligible')='true' then 1 else 0 end as PUT, case when u.product_identifier_type='DOTCOM_OFFER' and get_json_object(u.oscar_json,'$.result.offerAttributes.entry.logistics.isS2HEligible')='true' then 1 else 0 end as S2H, case when u.product_identifier_type='DOTCOM_OFFER' and get_json_object(u.oscar_json,'$.result.offerAttributes.entry.logistics.isS2SEligible')='true' then 1 else 0 end as S2S from catint.uber_flat_product_daily u  where u.date_id='20180321' and u.product_identifier_type!='PRIMARY_PRODUCT_OFFER' and get_json_object(product_offer_json,'$.offerLifecycleStatus')='ACTIVE') a left outer join (select barcode from euc0001.top_mm_go_get where ds='2018-02-02' and is_top_1m = 1) t on a.UPC=t.barcode group by a.date_id, a.product_id, a.offer_id, t.barcode, a.product_identifier_type, a.Pub_sts) b group by date_id, product_identifier_type, Pub_sts